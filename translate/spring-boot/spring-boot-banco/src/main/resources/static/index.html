<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Banco COBOL ‚Üí Spring Boot</title>
    <style>
        * { box-sizing: border-box; margin: 0; padding: 0; }
        body { font-family: 'Segoe UI', sans-serif; background: #f0f2f5; color: #333; }
        header { background: linear-gradient(135deg, #1a237e, #283593); color: #fff; padding: 1.5rem 2rem; text-align: center; }
        header h1 { font-size: 1.6rem; }
        header p { opacity: 0.8; margin-top: 0.3rem; font-size: 0.9rem; }
        .container { max-width: 900px; margin: 2rem auto; padding: 0 1rem; }
        .card { background: #fff; border-radius: 10px; box-shadow: 0 2px 8px rgba(0,0,0,0.1); margin-bottom: 1.5rem; overflow: hidden; }
        .card-header { padding: 1rem 1.5rem; font-weight: 700; font-size: 1.05rem; display: flex; align-items: center; gap: 0.5rem; }
        .card-header .badge { font-size: 0.7rem; padding: 2px 8px; border-radius: 4px; color: #fff; font-weight: 600; }
        .badge-get { background: #43a047; }
        .badge-post { background: #fb8c00; }
        .card-body { padding: 0 1.5rem 1.5rem; }
        .origin { font-size: 0.8rem; color: #777; margin-bottom: 1rem; }
        label { display: block; font-weight: 600; margin: 0.6rem 0 0.2rem; font-size: 0.85rem; }
        input, textarea { width: 100%; padding: 0.5rem; border: 1px solid #ccc; border-radius: 6px; font-size: 0.9rem; }
        textarea { resize: vertical; min-height: 100px; font-family: monospace; }
        button { margin-top: 1rem; padding: 0.6rem 1.5rem; border: none; border-radius: 6px; color: #fff; font-size: 0.9rem; cursor: pointer; }
        .btn-get { background: #43a047; }
        .btn-get:hover { background: #388e3c; }
        .btn-post { background: #fb8c00; }
        .btn-post:hover { background: #f57c00; }
        .result { margin-top: 1rem; padding: 1rem; background: #263238; color: #e0f7fa; border-radius: 6px; font-family: monospace; font-size: 0.85rem; white-space: pre-wrap; max-height: 300px; overflow-y: auto; display: none; }
        .result.show { display: block; }
        .result.error { border-left: 4px solid #e53935; }
        .result.success { border-left: 4px solid #43a047; }
        small { color: #888; display: block; margin-top: 0.2rem; }
    </style>
</head>
<body>

<header>
    <h1>üè¶ Banco COBOL ‚Üí Spring Boot</h1>
    <p>Panel de pruebas ‚Äî Traducci√≥n de programas COBOL a REST API</p>
</header>

<div class="container">

    <!-- HELLO WORLD -->
    <div class="card">
        <div class="card-header">
            <span class="badge badge-get">GET</span> /hello ‚Äî HelloWorld (tra1.cbl)
        </div>
        <div class="card-body">
            <p class="origin">Origen: tra1.cbl ‚Üí DISPLAY "Hello World!"</p>
            <button class="btn-get" onclick="callApi('GET', '/hello', null, 'res-hello')">Ejecutar</button>
            <div id="res-hello" class="result"></div>
        </div>
    </div>

    <!-- CONSULTA SALDO -->
    <div class="card">
        <div class="card-header">
            <span class="badge badge-get">GET</span> /api/saldo/{cuenta} ‚Äî Consulta Saldo (banco-consulta-saldo.cbl)
        </div>
        <div class="card-body">
            <p class="origin">Origen: banco-consulta-saldo.cbl ‚Üí ACCEPT WS-NUMERO-CUENTA / DISPLAY saldo</p>
            <label for="saldo-cuenta">N√∫mero de cuenta:</label>
            <input id="saldo-cuenta" value="ES1234567890123456" placeholder="Ej: ES1234567890123456">
            <small>Cuentas disponibles: ES1234567890123456, ES9876543210987654, ES5555666677778888</small>
            <button class="btn-get" onclick="callApi('GET', '/api/saldo/' + document.getElementById('saldo-cuenta').value, null, 'res-saldo')">Consultar Saldo</button>
            <div id="res-saldo" class="result"></div>
        </div>
    </div>

    <!-- EXTRACTO -->
    <div class="card">
        <div class="card-header">
            <span class="badge badge-get">GET</span> /api/extracto/{cuenta} ‚Äî Extracto (banco-extracto.cbl)
        </div>
        <div class="card-body">
            <p class="origin">Origen: banco-extracto.cbl ‚Üí PERFORM VARYING movimientos / DISPLAY extracto</p>
            <label for="ext-cuenta">N√∫mero de cuenta:</label>
            <input id="ext-cuenta" value="ES1234567890123456">
            <label for="ext-saldo">Saldo inicial:</label>
            <input id="ext-saldo" type="number" step="0.01" value="5000.00">
            <button class="btn-get" onclick="callApi('GET', '/api/extracto/' + document.getElementById('ext-cuenta').value + '?saldoInicial=' + document.getElementById('ext-saldo').value, null, 'res-extracto')">Generar Extracto</button>
            <div id="res-extracto" class="result"></div>
        </div>
    </div>

    <!-- INGRESOS -->
    <div class="card">
        <div class="card-header">
            <span class="badge badge-post">POST</span> /api/ingresos/{cuenta} ‚Äî Ingresos (banco-ingresos.cbl)
        </div>
        <div class="card-body">
            <p class="origin">Origen: banco-ingresos.cbl ‚Üí PERFORM UNTIL / ADD importe TO suma-total</p>
            <label for="ing-cuenta">N√∫mero de cuenta:</label>
            <input id="ing-cuenta" value="ES1234567890123456">
            <label for="ing-body">Ingresos (JSON):</label>
            <textarea id="ing-body">[
  { "numeroCuenta": "ES1234567890123456", "importe": 1500.00, "concepto": "NOMINA MARZO" },
  { "numeroCuenta": "ES1234567890123456", "importe": 200.00, "concepto": "INGRESO EFECTIVO" }
]</textarea>
            <button class="btn-post" onclick="callApi('POST', '/api/ingresos/' + document.getElementById('ing-cuenta').value, document.getElementById('ing-body').value, 'res-ingresos')">Registrar Ingresos</button>
            <div id="res-ingresos" class="result"></div>
        </div>
    </div>

    <!-- TRANSFERENCIA -->
    <div class="card">
        <div class="card-header">
            <span class="badge badge-post">POST</span> /api/transferencias ‚Äî Transferencia (banco-transferencia.cbl)
        </div>
        <div class="card-body">
            <p class="origin">Origen: banco-transferencia.cbl ‚Üí COMPUTE comision / IF saldo >= importe</p>
            <label for="trans-body">Datos transferencia (JSON):</label>
            <textarea id="trans-body">{
  "cuentaOrigen": "ES1234567890123456",
  "cuentaDestino": "ES9876543210987654",
  "importe": 500.00,
  "concepto": "PAGO ALQUILER"
}</textarea>
            <button class="btn-post" onclick="callApi('POST', '/api/transferencias', document.getElementById('trans-body').value, 'res-transfer')">Ejecutar Transferencia</button>
            <div id="res-transfer" class="result"></div>
        </div>
    </div>

</div>

<script>
async function callApi(method, path, body, resultId) {
    const el = document.getElementById(resultId);
    el.className = 'result show';
    el.textContent = 'Ejecutando...';

    try {
        const opts = { method, headers: {} };
        if (body) {
            opts.headers['Content-Type'] = 'application/json';
            opts.body = body;
        }
        const res = await fetch(path, opts);
        const text = await res.text();
        let formatted;
        try { formatted = JSON.stringify(JSON.parse(text), null, 2); }
        catch { formatted = text; }

        el.textContent = 'HTTP ' + res.status + ' ' + res.statusText + '\n\n' + formatted;
        el.className = res.ok ? 'result show success' : 'result show error';
    } catch (err) {
        el.textContent = 'Error de conexi√≥n: ' + err.message;
        el.className = 'result show error';
    }
}
</script>

</body>
</html>
